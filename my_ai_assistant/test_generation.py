# test_generation.py
from project_core.core.config import get_generative_llm
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.output_parsers import StrOutputParser

def test_generation_quality():
    print("="*30 + "\n๐ฌ ุจุฏุก ุงุฎุชุจุงุฑ ุฌูุฏุฉ ุงูุชูููุฏ ๐ฌ\n" + "="*30)
    
    try:
        llm = get_generative_llm()
    except Exception as e:
        print(f"โ ูุดู ุชููุฆุฉ ุงููููุฐุฌ ุงููุบูู ุงููุจูุฑ: {e}")
        return

    # --- **ุงูููุฌู ุงูููุงุฆู ุงููุญุณูู** ---
    template = """
    ุฃูุช ูุณุงุนุฏ ุฐูู ูุฎุจูุฑ. ูููุชู ูู ุงูุฅุฌุงุจุฉ ุนูู "ุงูุณุคุงู" ุจุงุณุชุฎุฏุงู "ุงูุณูุงู" ุงูููุฏู ููุท.
    
    **ููุงุนุฏ ุตุงุฑูุฉ:**
    1.  ุงูุฑุฃ ุงูุณูุงู ุจุนูุงูุฉ.
    2.  ุฅุฐุง ูุงู ุงูุณูุงู ูุญุชูู ุนูู ุฎุทูุงุช ูุงุถุญุฉ ุฃู ูุตู ูุงุฌูุฉ ูุณุชุฎุฏูุ ูู ุจุตูุงุบุฉ ุฅุฌุงุจุชู ูุฏููู ุชุนูููู ุฎุทูุฉ ุจุฎุทูุฉ. (ูุซุงู: "ููุนู ูุฐุงุ 1. ุงุถุบุท ุนูู ุงูุฒุฑ... 2. ุฃุฏุฎู...").
    3.  ุฅุฐุง ูุงู ุงูุณูุงู ูุง ูุญุชูู ุนูู ูุนูููุงุช ูุงููุฉ ููุฅุฌุงุจุฉุ ูุฌุจ ุฃู ุชููู "ุงููุนูููุงุช ุงููุชููุฑุฉ ูู ูุงุนุฏุฉ ุงููุนุฑูุฉ ุบูุฑ ูุงููุฉ ููุฅุฌุงุจุฉ ุนูู ูุฐุง ุงูุณุคุงู." ููุง ุชุถู ุฃู ูุนูููุงุช ูู ุนูุฏู.
    4.  ุฃุฌุจ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ูุจุฃุณููุจ ุงุญุชุฑุงูู ููุงุถุญ.

    **ุงูุณูุงู:**
    ---
    {context}
    ---

    **ุงูุณุคุงู:**
    ---
    {question}
    ---

    **ุงูุฅุฌุงุจุฉ ุงูููุงุฆูุฉ:**
    """
    prompt = ChatPromptTemplate.from_template(template)
    chain = prompt | llm | StrOutputParser()

    print("โ ุงููููุฐุฌ ูุงูููุฌู ุฌุงูุฒุงู ููุงุฎุชุจุงุฑ.\n")

    while True:
        try:
            context = input("\n> ุงูุตู ุงูุณูุงู ููุง (ูุญุชูู ุงููุณุชูุฏุงุช): ")
            if context.lower() in ['ุฎุฑูุฌ', 'exit', 'quit']:
                break
            question = input("> ุฃุฏุฎู ุงูุณุคุงู: ")
            
            print("\n--- ุชูููุฏ ุงูุฅุฌุงุจุฉ... ---")
            answer = chain.invoke({"context": context, "question": question})
            print("\n**ุฅุฌุงุจุฉ ุงููููุฐุฌ:**\n", answer)

        except Exception as e:
            print(f"\nโ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ: {e}")

    print("\n" + "="*30 + "\nโ ุงูุชูู ุงุฎุชุจุงุฑ ุฌูุฏุฉ ุงูุชูููุฏ.\n" + "="*30)

if __name__ == "__main__":
    test_generation_quality()
